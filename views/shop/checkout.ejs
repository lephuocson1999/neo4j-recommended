<!doctype html>
<html class="no-js" lang="en">
<head>
	<!-- Basic page needs -->
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Checkout || oxelar</title>
	<meta name="description" content="">
	<!-- Mobile specific metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png">
    
	<!-- all css hare -->
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/owl.carousel.css">
	<link rel="stylesheet" href="/css/animate.min.css">
	<link rel="stylesheet" href="/css/TimeCircles.css">
	<link rel="stylesheet" href="/css/jquery-ui.css">
	<link rel="stylesheet" href="/css/venobox.css">
	<link rel="stylesheet" href="/css/elegent-font.css">
	<link rel="stylesheet" href="/css/meanmenu.css">
	<link rel="stylesheet" href="/lib/css/nivo-slider.css">
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	<link rel="stylesheet" href="/style.css">
	<link rel="stylesheet" href="/css/responsive.css">
	
	<!-- modernizr js -->
	<script src="/js/vendor/modernizr-2.8.3.min.js"></script>
</head>
<body>
	<!--[if lt IE 8]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
	<!-- site content here -->
	<div class="page-inner">
		<!-- contact-us-header-area start -->
		<%- include ('./partials/header') %>
		
		<!-- contact-us-header-area end -->
		<!-- contact-us-mobile-menu-area start -->
	
		<!-- contact-us-mobile-menu-area end -->
		<!-- contact-us-area start -->
		<div class="container-fluid">
			<div class="contact-us-area white-bg">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<ol class="breadcrumb">
								<li><a href="/">Trang Chủ</a></li>
								<li class="active">Giỏ hàng</li>
							</ol>
						</div>
					</div>
					<div class="collapse_area">
					    <div class="row">
                            <div class="col-md-9 col-sm-9">
                                <div class="check">
                                    <h1>GIỎ HÀNG</h1>
                                </div>
                                <div class="faq-accordion">
                                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                      
                                        <div class="panel panel-default">
                                            <div class="panel-heading" role="tab" id="headingSix">
                                                <h4 class="panel-title">
                                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                                        <span class="number"></span>
                                                       Thông tin giỏ hàng
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix" aria-expanded="false">
                                                <div class="easy">
                                                    <div class="order-review">
                                                        <div class="table-responsive">
                                                            <table class="table">
                                                                <thead>
                                                                    <tr>
                                                                        <th class="width-1">Tên sản phẩm</th>
                                                                        <th class="width-2">Giá</th>
                                                                        <th class="width-3">Số lượng</th>
                                                                        <th class="width-4">Tổng tiền</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                   
                                                                            <% if(listOrder.lenght != 0){%>
                                                                                <% listOrder.forEach(product=>{ %>
                                                                                    <tr class = 'totalprice' total =
                                                                                       "<%= Number(product._fields[0].properties.price)*Number(product._fields[1].properties.HAVE)  %>"
                                                                                    >
                                                                                    <td>
                                                                                            <div class="o-pro-dec">
                                                                                                <p><%= product._fields[0].properties.name%></p>
                                                                                            </div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="o-pro-price">
                                                                                                <p><%= product._fields[0].properties.price%> </p>
                                                                                            </div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="o-pro-qty">
                                                                                                <p><%= product._fields[1].properties.HAVE%></p>
                                                                                            </div>
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="o-pro-subtotal">
                                                                                                <p></p>
                                                                                            </div>
                                                                                        </td>
                                                                                        <td>
                                                                                <%}) %>
                                                                                <%}%>
                                                                    </tr>
                                                                </tbody>
                                                                <tfoot>
                                                                    <tr>
                                                                        <td colspan="3">Tổng hóa đơn </td>
                                                                        <td xcolspan="1">
                                                                                <% if(listOrder.lenght != 0){%>
                                                                                    <% total = 0 %>
                                                                                    <% listOrder.forEach(product=>{ %>
                                                                                        <% total = total+ Number(product._fields[0].properties.price)  %>
                                                                                        <%}) %>
                                                                                        <p id='toltal-price's><%= total  %></p>
                                                                                    <%}%>   
                                                                                        </td>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                        <div class="block-right">
                                                            
                                                            <button id='thanh-toan'class="button2 get" type="button" title="">
                                                                <span >Thanh Toán</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           
                        </div>
					</div>
				</div>
			</div>
		</div>
		<!-- contact-us-area end -->
		<!-- contact-us-service-area start -->
		<%- include ('./partials/footer') %>
		<!-- contact-us-service-area end -->
		<!-- contact-us-footer-top-area start -->
		
		<!-- contact-us-footer-top-area end -->
		<!-- contact-us-footer-banner-area start -->
		
		<!-- contact-us-footer-bottom-area end -->
	</div>

	<!-- all js here -->
	<script src="/js/vendor/jquery-1.12.0.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/lib/js/jquery.nivo.slider.pack.js"></script>
	<script src="/lib/js/nivo-active.js"></script>
	<script src="/js/owl.carousel.min.js"></script>
	<script src="/js/wow.min.js"></script>
	<script src="/js/TimeCircles.js"></script>
	<script src="/js/venobox.js"></script>
	<script src="/js/jquery-ui.min.js"></script>
	<script src="/js/jquery.meanmenu.js"></script>
	<script src="/js/jquery.scrollUp.js"></script>
	<script src="/js/plugins.js"></script>
	<script src="/js/main.js"></script>
</body>
<script>
$(document).ready(function(){
    let idProduct = $('.btn-add-cart').attr('id');
		let idCustomer = $('.customer-name').attr("id");
		let listIdProductOrder = JSON.parse(window.localStorage.getItem('litsProductOrder'));
		console.log(listIdProductOrder);
		console.log(typeof(listIdProductOrder));

		if(listIdProductOrder!='null' &&listIdProductOrder){	
			console.log('khac null');
			console.log(listIdProductOrder)
			console.log(listIdProductOrder[0])
			listIdProductOrder.forEach(id_product =>{
				$.ajax({
					url : `/products/find/${id_product.idProduct}`,
					method : 'post',
					success :function(result){
						console.log(result.data.data._fields[0].properties);
						$('.cart-open').append(`
								<li class="single-cart">
									<div class="cart-img">
										<a href="#"><img src="${result.data.data._fields[0].properties.image}" alt="" /></a>
									</div>
									<div class="cart-content">
										<h4><a href="#">1X <span>${result.data.data._fields[0].properties.name}</span></a></h4>
										<span><a href="#">${id_product.amout} </a></span>
										<span class="cart-price">${result.data.data._fields[0].properties.price}</span>
									</div>
									<div class="cart-del">
										<i class="fa fa-times" aria-hidden="true"></i>
									</div>
								</li>
						`);
					},
					error : function(error){
						console.log(error)
					}
				})
			})
		
		}
		$('.btn-add-cart').click(function(){
			console.log('object');
			let  amout = $('#amout_product').val();
			$('.cart-open').empty();
			if(idCustomer!=''&&idCustomer){ //logined
				//create order line or update order old -- status order pedding 
				if($('.cart-open').children('li').length == 0){
					console.log('hello_create_new_order')
					let timeOrder = new Date();	
					$.ajax({
					url:'/orders/new',
					method:'post',
					data : {
						idCustomer : idCustomer,
						"listProduct" : [{"id" : idProduct,
						"amout" : amout}],
						timeOrder : timeOrder
					},
					success: function(result){
						console.log(result);
						
					$('.cart-open').append(``);
					},
					error : function(error){
						console.log(error);
					}
				});
				}else{
					$.ajax({
					url:'/orders/update',
					method:'post',
					data : {
						idCustomer : idCustomer,
						idProduct : idProduct,
						amout : amout
					}
				});

				$('.cart-open').append(``);

				}
				
				
			}
			//if not login will save listidProduct to localstoreg
			if(listIdProductOrder!='null' &&listIdProductOrder){ // if list had been
				console.log(listIdProductOrder);
				listIdProductOrder.push({idProduct, amout});
				window.localStorage.removeItem('litsProductOrder');
				window.localStorage.setItem('litsProductOrder', JSON.stringify (listIdProductOrder));
			}else{
				let  newListProductOrder = [idProduct];
				console.log(newListProductOrder);
				window.localStorage.removeItem('litsProductOrder');
				window.localStorage.setItem('litsProductOrder',JSON.stringify (newListProductOrder));
			}
			$('.cart-open').append(`
					<li class="single-cart">
						<div class="cart-img">
							<a href="#"><img src="/img/cart/1.jpg" alt="" /></a>
						</div>
						<div class="cart-content">
							<h4><a href="#">1X <span>Faded Short Sleeves <br>T-shirt</span></a></h4>
							<span><a href="#">S, Yellow </a></span>
							<span class="cart-price">$ 16.84</span>
						</div>
						<div class="cart-del">
							<i class="fa fa-times" aria-hidden="true"></i>
						</div>
					</li>
			`);

		}); 
		
		console.log(idProduct);
		if(idCustomer!=''&&idCustomer){
			let time = 1;
			$.ajax({ 
                url: "/products/forcus",
                method: "POST",
                data: { time : time, idCustomer : idCustomer, idProduct : idProduct },
                success :function(data){
					console.log('object');
                },
                error(){
                }
			}) ;
		}



        $('#thanh-toan').click(function(){
            $.ajax({ 
                        url: "/products/forcus",
                        method: "POST",
                        data: { time : time, idCustomer : idCustomer, idProduct : idProduct },
                        success :function(data){
                            console.log('object');
                        },
                        error(){
                        }
                    }) ;
        })
        
})

</script>
</html>